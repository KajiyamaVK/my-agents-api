meta {
  name: Create Token
  type: http
  seq: 1
}

post {
  url: http://localhost:3000/llm/token
  body: json
  auth: inherit
}

headers {
  Content-Type: application/json
  Accept: application/json
  Authorization: <Authorization>
}

body:json {
  {
    "clientId": "{{flowClientID}}",
    "clientSecret": "{{flowClientSecret}}",
    "appToAccess": "llm-api"
  }
}

vars:post-response {
  access_token: access_token
}

script:post-response {
  // Parse the response body
  let body = res.getBody();
  
  // Set the 'token' environment variable
  // (Assumes your API returns { "access_token": "..." })
  if (body.access_token) {
      bru.setEnvVar("token", body.access_token);
  }
}

settings {
  encodeUrl: true
  timeout: 0
}
